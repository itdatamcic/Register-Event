<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>MCIC-Register</title>

Â  Â  <link rel="icon" type="image/png" href="https://img5.pic.in.th/file/secure-sv1/-72f36e2606e6a703c.png">

Â  Â  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
Â  Â  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
Â  Â  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-color: #2c3e50;
Â  Â  Â  Â  Â  Â  --secondary-color: #3498db;
Â  Â  Â  Â  Â  Â  --background-color: #ecf0f1;
Â  Â  Â  Â  Â  Â  --form-background: #ffffff;
Â  Â  Â  Â  Â  Â  --input-border-color: #bdc3c7;
Â  Â  Â  Â  Â  Â  --input-focus-color: #3498db;
Â  Â  Â  Â  Â  Â  --text-color: #2c3e50;
Â  Â  Â  Â  Â  Â  --label-color: #555;
Â  Â  Â  Â  Â  Â  --danger-color: #e74c3c;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Sarabun', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--background-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-container {
Â  Â  Â  Â  Â  Â  background-color: var(--form-background);
Â  Â  Â  Â  Â  Â  padding: 2.5rem 3rem;
Â  Â  Â  Â  Â  Â  max-width: 700px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin: 2rem auto;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  border-top: 5px solid var(--secondary-color);
Â  Â  Â  Â  }

Â  Â  Â  Â  .logo-container {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .logo-img {
Â  Â  Â  Â  Â  Â  max-width: 120px;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-title {
Â  Â  Â  Â  Â    text-align: center;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  margin-bottom: 2.5rem;
Â  Â  Â  Â  Â  Â  color: var(--primary-color);
Â  Â  Â  Â  Â  Â  font-size: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-label {
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: var(--label-color);
Â  Â  Â  Â  Â  Â  margin-bottom: .5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-control, .custom-select, .select2-container .select2-selection--single {
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  height: 48px;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--input-border-color);
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  background-color: #f8f9fa;
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-control:focus, .custom-select:focus, .select2-container--default .select2-selection--single:focus {
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
Â  Â  Â  Â  Â  Â  border-color: var(--input-focus-color);
Â  Â  Â  Â  Â  Â  background-color: var(--form-background);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .select2-container--default .select2-selection--single {
Â  Â  Â  Â  Â  Â  border: 1px solid var(--input-border-color);
Â  Â  Â  Â  }

Â  Â  Â  Â  .select2-container--default .select2-selection--single .select2-selection__rendered {
Â  Â  Â  Â  Â  Â  line-height: 46px;
Â  Â  Â  Â  Â  Â  padding-left: 1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .select2-container--default .select2-selection--single .select2-selection__arrow {
Â  Â  Â  Â  Â  Â  height: 46px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-submit {
Â  Â  Â  Â  Â  Â  background: var(--secondary-color);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 12px 30px;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-submit:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-3px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
Â  Â  Â  Â  Â  Â  background: #2980b9;
Â  Â  Â  Â  }

Â  Â  Â  Â  label.required::after {
Â  Â  Â  Â  Â  Â  content: " *";
Â  Â  Â  Â  Â  Â  color: var(--danger-color);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .input-group .btn-location {
Â  Â  Â  Â  Â  Â  border-top-right-radius: 8px;
Â  Â  Â  Â  Â  Â  border-bottom-right-radius: 8px;
Â  Â  Â  Â  Â  Â  background-color: var(--secondary-color);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  width: 50px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .input-group .btn-location:hover {
Â  Â  Â  Â  Â  Â  background-color: #2980b9;
Â  Â  Â  Â  }

Â  Â  Â  Â  .input-group .form-control {
Â  Â  Â  Â  Â  Â  border-right: none;
Â  Â  Â  Â  }

Â  Â  </style>
</head>
<body>

<div class="container">
Â  Â  <div class="form-container">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="logo-container">
Â  Â  Â  Â  Â  Â  <img src="https://img2.pic.in.th/pic/modern-cass-international-cosmetic-vietnam_400x400_341568856.png?text=YOUR+LOGO" alt="Logo" class="logo-img">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h3 class="form-title">à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸£à¹ˆà¸§à¸¡à¸à¸´à¸ˆà¸à¸£à¸£à¸¡</h3>

Â  Â  Â  Â  <form method="post" autocomplete="off" name="data-sheet" id="registerForm">
Â  Â  Â  Â  Â  Â  <input type="hidden" name="userID" id="userID">
Â  Â  Â  Â  Â  Â  <input type="hidden" name="profileLine" id="profileLine">

Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="fullName" class="form-label required">à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="fullName" name="à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="shopName" class="form-label required">à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™à¹€à¸ªà¸£à¸´à¸¡à¸ªà¸§à¸¢/à¸šà¸²à¸£à¹Œà¹€à¸šà¸­à¸£à¹Œ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="shopName" name="à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™à¹€à¸ªà¸£à¸´à¸¡à¸ªà¸§à¸¢/à¸šà¸²à¸£à¹Œà¹€à¸šà¸­à¸£à¹Œ" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="checkin" class="form-label required">à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="checkin" name="à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™" placeholder="à¸à¸”à¸›à¸¸à¹ˆà¸¡ ğŸ“ à¹€à¸à¸·à¹ˆà¸­à¸£à¸°à¸šà¸¸à¹à¸¥à¸°à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡" readonly required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group-append">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline-secondary btn-location" type="button" id="getLocationBtn"><i class="fas fa-map-marker-alt"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="eventResult" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="hidden" id="eventLocation" name="à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸‡à¸²à¸™">
Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="hidden" id="memo" name="Memo">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="province" class="form-label required">à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="custom-select" id="province" name="à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-- à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸” --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="district" class="form-label required">à¸­à¸³à¹€à¸ à¸­</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="custom-select" id="district" name="à¸­à¸³à¹€à¸ à¸­" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-- à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸­à¸³à¹€à¸ à¸­ --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="subdistrict" class="form-label required">à¸•à¸³à¸šà¸¥</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="custom-select" id="subdistrict" name="à¸•à¸³à¸šà¸¥" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-- à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸•à¸³à¸šà¸¥ --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="zipcode" class="form-label required">à¸£à¸«à¸±à¸ªà¹„à¸›à¸£à¸©à¸“à¸µà¸¢à¹Œ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="zipcode" name="à¸£à¸«à¸±à¸ªà¹„à¸›à¸£à¸©à¸“à¸µà¸¢à¹Œ" readonly required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="address" class="form-label required">à¸šà¹‰à¸²à¸™à¹€à¸¥à¸‚à¸—à¸µà¹ˆ</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="address" name="à¸šà¹‰à¸²à¸™à¹€à¸¥à¸‚à¸—à¸µà¹ˆ" required>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="phone" class="form-label required">à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" class="form-control" id="phone" name="à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="age" class="form-label required">à¸­à¸²à¸¢à¸¸</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" class="form-control" id="age" name="à¸­à¸²à¸¢à¸¸" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="status" class="form-label required">à¸ªà¸–à¸²à¸™à¸°</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select class="custom-select" id="status" name="à¸ªà¸–à¸²à¸™à¸°" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-- à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸° --</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸£à¹‰à¸²à¸™">à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸£à¹‰à¸²à¸™</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="à¸à¸™à¸±à¸à¸‡à¸²à¸™">à¸à¸™à¸±à¸à¸‡à¸²à¸™</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="text-center mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-submit">à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
Â  Â  // JavaScript remains unchanged
Â  Â  async function main() {
Â  Â  Â  Â  await liff.init({ liffId: "2008243853-w5KYZ5oN" });
Â  Â  Â  Â  if (!liff.isLoggedIn()) {
Â  Â  Â  Â  Â  Â  liff.login();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const profile = await liff.getProfile();
Â  Â  Â  Â  Â  Â  document.getElementById('userID').value = profile.userId;
Â  Â  Â  Â  Â  Â  document.getElementById('profileLine').value = profile.displayName;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  main();

Â  Â  const scriptURL = 'https://script.google.com/macros/s/AKfycbx9UxYz9YjX_0JBPA73I6rZ73kWa1oFGX7Q0xCW2kGYuGu6tAtqtQpGrtCUyIfWyDLO/exec';
Â  Â  const form = document.forms['data-sheet'];
Â  Â  let addressData = [];
Â  Â  let eventLocationsData = [];

Â  Â  $(document).ready(function() {
Â  Â  Â  Â  $('#province, #district, #subdistrict, #status').select2({
Â  Â  Â  Â  Â  Â  Â  minimumResultsForSearch: InfinityÂ 
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  $('#province, #district, #subdistrict').select2();

Â  Â  Â  Â  const addressDataUrl = scriptURL + '?action=getAddressData';
Â  Â  Â  Â  fetch(addressDataUrl)
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data && data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addressData = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  populateProvinces();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Failed to load address data:', err);
Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”!', `à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¹„à¸”à¹‰: ${err.message}`, 'error');
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  const eventLocationsUrl = scriptURL + '?action=getEventLocations';
Â  Â  Â  Â  fetch(eventLocationsUrl)
Â  Â  Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  eventLocationsData = data;
Â  Â  Â  Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸‡à¸²à¸™à¹„à¸”à¹‰:', err);
Â  Â  Â  Â  Â  Â  Â  Â  Â Swal.fire('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”!', `à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸‡à¸²à¸™à¹„à¸”à¹‰`, 'error');
Â  Â  Â  Â  Â  Â  });
Â  Â  });

Â  Â  function populateProvinces() {
Â  Â  Â  Â  const provinces = [...new Set(addressData.map(row => row[0]))].sort();
Â  Â  Â  Â  provinces.forEach(province => {
Â  Â  Â  Â  Â  Â  $('#province').append(new Option(province, province));
Â  Â  Â  Â  });
Â  Â  }

Â  Â  $('#province').on('change', function() {
Â  Â  Â  Â  const selectedProvince = $(this).val();
Â  Â  Â  Â  $('#district').html('<option value="">-- à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸­à¸³à¹€à¸ à¸­ --</option>').val('').trigger('change');
Â  Â  Â  Â  $('#subdistrict').html('<option value="">-- à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸•à¸³à¸šà¸¥ --</option>').val('').trigger('change');
Â  Â  Â  Â  $('#zipcode').val('');
Â  Â  Â  Â  if (!selectedProvince) return;
Â  Â  Â  Â  const districts = [...new Set(addressData.filter(row => row[0] === selectedProvince).map(row => row[1]))].sort();
Â  Â  Â  Â  districts.forEach(district => {
Â  Â  Â  Â  Â  Â  $('#district').append(new Option(district, district));
Â  Â  Â  Â  });
Â  Â  });

Â  Â  $('#district').on('change', function() {
Â  Â  Â  Â  const selectedProvince = $('#province').val();
Â  Â  Â  Â  const selectedDistrict = $(this).val();
Â  Â  Â  Â  $('#subdistrict').html('<option value="">-- à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸•à¸³à¸šà¸¥ --</option>').val('').trigger('change');
Â  Â  Â  Â  $('#zipcode').val('');
Â  Â  Â  Â  if (!selectedDistrict) return;
Â  Â  Â  Â  const subdistricts = [...new Set(addressData.filter(row => row[0] === selectedProvince && row[1] === selectedDistrict).map(row => row[2]))].sort();
Â  Â  Â  Â  subdistricts.forEach(subdistrict => {
Â  Â  Â  Â  Â  Â  $('#subdistrict').append(new Option(subdistrict, subdistrict));
Â  Â  Â  Â  });
Â  Â  });

Â  Â  $('#subdistrict').on('change', function() {
Â  Â  Â  Â  const selectedProvince = $('#province').val();
Â  Â  Â  Â  const selectedDistrict = $('#district').val();
Â  Â  Â  Â  const selectedSubdistrict = $(this).val();
Â  Â  Â  Â  const match = addressData.find(row => row[0] === selectedProvince && row[1] === selectedDistrict && row[2] === selectedSubdistrict);
Â  Â  Â  Â  $('#zipcode').val(match ? match[3] : '');
Â  Â  });

Â  Â  function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
Â  Â  Â  var R = 6371;
Â  Â  Â  var dLat = (lat2 - lat1) * (Math.PI / 180);
Â  Â  Â  var dLon = (lon2 - lon1) * (Math.PI / 180);
Â  Â  Â  var a =
Â  Â  Â  Â  Math.sin(dLat / 2) * Math.sin(dLat / 2) +
Â  Â  Â  Â  Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
Â  Â  Â  Â  Math.sin(dLon / 2) * Math.sin(dLon / 2);
Â  Â  Â  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
Â  Â  Â  return R * c;
Â  Â  }

Â  Â  $('#getLocationBtn').on('click', function() {
Â  Â  Â  Â  if (!navigator.geolocation) {
Â  Â  Â  Â  Â  Â  return Swal.fire('à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”', 'à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š Geolocation', 'error');
Â  Â  Â  Â  }
Â  Â  Â  Â  if (eventLocationsData.length === 0) {
Â  Â  Â  Â  Â  Â  return Swal.fire('à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”', 'à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™', 'info');
Â  Â  Â  Â  }
Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  title: 'à¸à¸³à¸¥à¸±à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡',
Â  Â  Â  Â  Â  Â  text: 'à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ...',
Â  Â  Â  Â  Â  Â  allowOutsideClick: false,
Â  Â  Â  Â  Â  Â  didOpen: () => { Swal.showLoading(); }
Â  Â  Â  Â  });
Â  Â  Â  Â  $('#checkin, #eventLocation, #memo').val('');
Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(position => {
Â  Â  Â  Â  Â  Â  const userLat = position.coords.latitude;
Â  Â  Â  Â  Â  Â  const userLon = position.coords.longitude;
Â  Â  Â  Â  Â  Â  let foundLocation = false;
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  for (const event of eventLocationsData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventName = event[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventCoords = event[1].split(',').map(coord => parseFloat(coord.trim()));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventMemo = event[2];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventLat = eventCoords[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const eventLon = eventCoords[1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const distance = getDistanceFromLatLonInKm(userLat, userLon, eventLat, eventLon);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (distance <= 10) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#checkin').val(`${userLat}, ${userLon}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#eventLocation').val(eventName);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#memo').val(eventMemo);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: 'success',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `à¸„à¸¸à¸“à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸‚à¸­à¸‡: <b>${eventName}</b>`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  foundLocation = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (!foundLocation) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire('à¸™à¸­à¸à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ', 'à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸” (à¸£à¸°à¸¢à¸°à¸«à¹ˆà¸²à¸‡à¹€à¸à¸´à¸™ 10 à¸à¸¡.)', 'warning');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  }, error => {
Â  Â  Â  Â  Â  Â  Swal.fire('à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”', 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹„à¸”à¹‰ à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œ', 'error');
Â  Â  Â  Â  });
Â  Â  });

Â  Â  form.addEventListener('submit', e => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  title: 'à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...',
Â  Â  Â  Â  Â  Â  text: 'à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ',
Â  Â  Â  Â  Â  Â  allowOutsideClick: false,
Â  Â  Â  Â  Â  Â  didOpen: () => { Swal.showLoading(); }
Â  Â  Â  Â  });
Â  Â  Â  Â  fetch(scriptURL, { method: 'POST', body: new FormData(form)})
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  if (data.result === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: 'success',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showConfirmButton: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timer: 2000
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(liff.isInClient()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  liff.closeWindow();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.reset();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#province, #district, #subdistrict, #status').val('').trigger('change');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else { throw new Error(data.error || 'Unknown error occurred'); }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error!', error.message);
Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”!', `à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  });
Â  Â  });
</script>

</body>
</html>
